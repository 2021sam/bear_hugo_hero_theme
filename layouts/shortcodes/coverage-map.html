<style>
    /* Load Leaflet CSS even if we're in the body */
    @import url('https://unpkg.com/leaflet@1.9.4/dist/leaflet.css');
    .coverage-map { width: 100%; height: 360px; border-radius: 12px; }
    @media (min-width: 768px) { .coverage-map { height: 460px; } }
  </style>
  
  <div id="coverage-map-{{ .Get "id" | default "1" }}" class="coverage-map" aria-label="Service coverage map"></div>
  
  <script>
  (function() {
    const elId  = "coverage-map-{{ .Get "id" | default "1" }}";
    const lat   = parseFloat("{{ .Get "lat" | default "37.6335943" }}");
    const lng   = parseFloat("{{ .Get "lng" | default "-122.1244158" }}");
    const miles = parseFloat("{{ .Get "radius_miles" | default "50" }}");
    const zoom  = parseInt("{{ .Get "zoom" | default "9" }}", 10);
  
    // Load Leaflet JS, then init the map
    function loadLeaflet(cb) {
      if (window.L) return cb();
      var s = document.createElement('script');
      s.src = "https://unpkg.com/leaflet@1.9.4/dist/leaflet.js";
      s.onload = cb;
      document.head.appendChild(s);
    }
  
    function init() {
      var el = document.getElementById(elId);
      if (!el) return;
  
      var map = L.map(el, { scrollWheelZoom: false }).setView([lat, lng], zoom);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap'
      }).addTo(map);
  
      L.marker([lat, lng]).addTo(map).bindPopup("BEAR â€“ 3393 Enterprise Ave, Hayward");
  
      var meters = miles * 1609.344;
      L.circle([lat, lng], {
        radius: meters,
        color: "#1d4ed8",
        fillColor: "#3b82f6",
        fillOpacity: 0.12,
        weight: 2
      }).addTo(map);
    }
  
    loadLeaflet(init);
  })();
  </script>
  